{
  "image": "mcr.microsoft.com/devcontainers/base:ubuntu",
  "features": {
    "ghcr.io/devcontainers/features/nix:1": {
      "extraNixConfig": "experimental-features = nix-command flakes, download-buffer-size = 1073741824",
      "useAttributePath": true
    }
  },

  "onCreateCommand": "sudo apt-get install -y acl && sudo setfacl -k /tmp && nix profile install .#dev-environment && (ln -s ../.devcontainer/CMakeUserPresets.json cs174projectCleanup/ && echo cs174projectCleanup/CMakeUserPresets.json >> .git/info/exclude ; true)",
  "customizations": {
    "vscode": {
      "extensions": [
        "ms-vscode.cpptools-extension-pack"
      ],
      "settings": {
        "cmake.sourceDirectory": "${containerWorkspaceFolder}/cs174projectCleanup",
        "cmake.useCMakePresets": "always"
      }
    }
  },

  "remoteEnv": {
    "EM_CACHE": "/home/vscode/.nix-profile/share/emscriptenCache",
    "EM_FROZEN_CACHE": "1",
    "PYTHON": "/home/vscode/.nix-profile/bin/python",

    "CMAKE_TOOLCHAIN_FILE": "/home/vscode/.nix-profile/share/emscripten/cmake/Modules/Platform/Emscripten.cmake",
    "CMAKE_BUILD_TYPE": "Release"
  }
}
